#!/bin/sh

CONFDIR="/usr/share/pardalys/etc"
MANIFEST="/usr/share/pardalys/manifests/kolab.pp"
ENVIRONMENT="--environment=production"
FACTS="--factpath=/usr/share/pardalys/facter"
MODULES="--modulepath=/usr/share/pardalys/modules"

if [ -e "/usr/share/pardalys/dev-pardalys/pardalys" ]; then
    CONFDIR="/usr/share/pardalys/dev-pardalys/pardalys/etc"
    MANIFEST="/usr/share/pardalys/dev-pardalys/pardalys/manifests/kolab.pp"
    ENVIRONMENT="--environment=development"
    FACTS="--factpath=/usr/share/pardalys/dev-pardalys/pardalys/facter"
    MODULES="--modulepath=/usr/share/pardalys/dev-pardalys/pardalys/modules"
fi

if [ ! -e "${CONFDIR}" ]; then
    echo "Configuration directory ${CONFDIR} is missing. Aborting!"
    exit 1
fi

if [ ! -e "${MANIFEST}" ]; then
    echo "Manifest ${MANIFEST} is missing. Aborting!"
    exit 1
fi

puppet --confdir="${CONFDIR}" ${ENVIRONMENT} ${FACTS} ${MODULES} --verbose ${MANIFEST} $*
